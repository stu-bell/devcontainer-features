# TODO

1. TODOs in test/test-builds.sh
1. release pipeline triggering too often?
1. Can we move documentation generation to a pipeline before release?
1. Use ./test/test-builds.sh to test duplicate installs and combinations of features (like the devconainer test --global option?)
1. test-build.sh to start container and execute a test.sh script referenced by the scenario


# To add a feature

1. Add a folder in test for your feature
1. Start the devcontainer for the repo
1. Make sure the test works (fails!)
2. Add the feature folder name to the test workflow yaml matrix
1. Build out your feature until your tests pass
1. Use your feature locally in your .devcontainer projects
1. Or [disbribute it](./README-template.md#distributing-features)

# Dev iterations requiring feature reinstalls

Try building with --no-cache

```
devpod up . --provider-option --no-cache
```

To reinstall the feature after a code change (using devpod, podman, powershell)

```
devpod delete .; podman builder prune -a -f; devpod up . --reset
```

```
docker builder prune -a -f
```



# Tests

https://github.com/devcontainers/cli/blob/main/docs/features/test.md
https://containers.dev/guide/feature-authoring-best-practices

Command to quickly test feature with a particular image:
`devcontainer features test --skip-scenarios -f <FEATURE_NAME>  -i <IMAGE_URI>`
where <IMAGE_URI> could be, eg: mcr.microsoft.com/devcontainers/base:ubuntu 

To test all devcontainer.json configs in scenarios.json:

`devcontainer features test --skip-autogenerated`

## Duplicate tests

TODO

Tests what happens if a devcontainer.json installs the feature multiple times with different options. Feature installs should be idempotent.

## Testing build failure messages

There may be some instances in which you want to test that your install script correctly fails in the absence of certain dependencies.

test-builds.sh is under development to test this

# Docs generation

From the src directory (devcontainer cli command is available in the devcontainer for this project)
`devcontainer features generate-docs -n stu-bell/devcontainer-features`

